#1.2 $GOPATH и рабочее простанство

## $GOPATH

Все команды Go полагаются на одну важную переменную окружения называемую $GOPATH. Обратите внимание, что это не переменная $GOROOT хранящая путь установки Go. Эта переменная содержит путь к месту где вы работаете над кодом Go у себя на компьютере(рабочее пространство). (пути на вашем и моём компьютерах вероятно будет отличаться, пожалуйсто замените его на свой).

В Unix подобных системах переменная назначается вот так:

	export GOPATH=/home/apple/mygo
	
В Windows, вам нужно создать новую переменную окружения и назвать её GOPATH, затем присвоить ей значение `c:\mygo`( ***Это значение зависит от места где располагается ваше рабочее пространство для кодов Go*** )

В вашей переменной $GOPATH может находиться несколько путей до разных рабочих пространств, но помните, что вам необходимо использовать `:` (`;` в Windows) для отделения их друг от друга. На данном этапе команда `go get` будет сохранять контент в вашу первый путь в $GOPATH.

В $GOPATH, вы должны иметь 3 папки:

- `src` для исходных кодов, имеющих расширение .go, .c, .g, .s.
- `pkg` для скомпилированных файлов, имеющих расширение .a.
- `bin` для исполняемых файлов

В данной книге я использую `mygo` как мой единственный путь в $GOPATH

## Директория для пакетов

Создайте пакеты состоящие из файлов исходных кодов и соответсвующую иерархию папок `$GOPATH/src/mymath/sqrt.go` (`mymath` это название пакета) ( ***Автор использует `mymath` как имя пакета, и такое же имя для папки содержащей файлы исходных кодов этого пакета***)

Каждый раз когда вы создаёте пакет, вы должны создать новую папку в директории `src`. Имя папки обычно такое же как и пакета который вы собираетесь использовать. Вы можете создавать вложенную иерархию папок, если хотите. Для примера, если вы создадите иерархию `$GOPATH/src/github.com/astaxie/beedb`, тогда путь к пакету будет `github.com/astaxie/beedb`. Имя пакета будет последняя папка в вашем пути, в данном случае `beedb`.

Давайте рассмотрим пример, выполните следующие команды.

	cd $GOPATH/src
	mkdir mymath
	
Создайте новый файл называемый `sqrt.go` со следующим содержанием.	

	// Исходный код $GOPATH/src/mymath/sqrt.go
	package mymath
	
	func Sqrt(x float64) float64 {
		z := 0.0
		for i := 0; i < 1000; i++ {
			z -= (z*z - x) / (2 * x)
		}
		return z
	}

На данный момент у вас должен быть создан пакет с соответствующим кодом. Я рекомендую вам использовать одно и тоже имя для ваших пакетов и для соответсвующих каталогов. Эти каталоги должны содержать все файлы исходных кодов принадлежащих данному пакету.	

## Компиляция пакетов

Вы уже создали ваш собственный пакет, но как нам скомпилировать его для дальнейшего использования? Существует два способа сделать это.

1. Перейдите в терминале в директорию содержащую ваш пакет и выполните команду `go install`.
2. Или в самом рабочем пространстве выполните команду с указанием имени пакета `go install mymath` 

После компиляции, вы можете открыть следующую папку.

	cd $GOPATH/pkg/${GOOS}_${GOARCH}
	// здесь вы должны обнаружить сгенерированный файл
	mymath.a
	
Файл с расширением `.a` это бинарный файл нашего пакета. Как нам его использовать?	

Очевидно, мы должны создать новое приложение чтобы использовать его.

Создайте новый пакет называемый `mathapp`.

	cd $GOPATH/src
	mkdir mathapp
	cd mathapp
	vim main.go
	
введите следующий код 

	//исходный код $GOPATH/src/mathapp/main.go.
	package main
	
	import (
		"mymath"
		"fmt"
	)
	
	func main() {
		fmt.Printf("Hello, world. Sqrt(2) = %v\n", mymath.Sqrt(2))
	}
	

Чтобы скомпилировать это приложение, вам необходимо сменить текущую директорию, которая в данном случае будет `$GOPATH/src/mathapp`, затем выполните `go install`. Сейчас вы можете увидеть исполняемый файл называемый `mathapp` перейдя в папку `$GOPATH/bin/`. Чтобы запустить программу, используйте команду `./mathapp`. В терминал должно вывестись следующее:

	Hello world. Sqrt(2) = 1.414213562373095
	
## Установка удалённых пакетов

В Go есть возможность установки удалённых пакетов, через команду `go get`. Поддерживается большинство cообществ с открытым кодом, включая Github, Google Code, BitBucket, и Launchpad.

	go get github.com/astaxie/beedb

Вы можете использовать команду `go get -u …` для обновления ваших удалённых пакетов, она же автоматически установит все необходимые зависимости.

Этот инструмент использует разные системы контроля версий для разных платформ с открытым кодом. Например, `git` для Github'a и `hg` для Google Code. Таким образом, вы должны установить необходимые системы контроля версий, прежде чем использовать `go get`.

После выполнения предыдущих команд, структура папок должна выглядить следующим образом.

	$GOPATH
		src
		 |-github.com
		 	 |-astaxie
		 	 	 |-beedb
		pkg
		 |--${GOOS}_${GOARCH}
		 	 |-github.com
		 	 	 |-astaxie
		 	 	 	 |-beedb.a
		 	 	 	 
Команда `go get` клонирует исходные коды в $GOPATH/src, после чего можете выполнить `go install`.

Вы можете использовать удалённые пакеты так же как мы использовали локальные пакеты ранее.

	import "github.com/astaxie/beedb"
	
## Полная структура каталога	

Если вы выполнили все выше перечисленные шаги, ваша структура каталога должна выглядить следующим образом.

	bin/
		mathapp
	pkg/
		${GOOS}_${GOARCH}, например darwin_amd64, linux_amd64
      mymath.a
      github.com/
        astaxie/
          beedb.a
	src/
		mathapp
			main.go
		mymath/
			sqrt.go
		github.com/
			astaxie/
				beedb/
					beedb.go
					util.go
					
Теперь Вы в состоянии четко увидеть структуру каталогов; `bin` содержит исполняемые файлы, `pkg` содержит скомилированные файлы и `src` содержит пакеты исходных файлов.

(Формат переменных окружения в Windows выглядит как `%GOPATH%`, однако эта книга в основном поддерживает стиль записи Unix, таким образом, пользователи Windows должны заменить их самостоятельно.)

## Ссылки

- [Содержание](preface.md)
- Предыдущая секция: [Установка](01.1.md)
- Следующая секция: [Команды Go](01.3.md)
